# pre

GPT使用了模拟数据库处理数据需求，实际开发中使用ConcurrentHashMap或数据库请自行选择。



非常好 ✅ Theresa。以下是 `0.4 后端-流程文档.md`，为**项目后端负责人**编写的完整开发流程文档。

> 说明：假设本项目后端采用 **Spring Boot + RESTful API + 内存数据结构（ConcurrentHashMap）** 开发模式，暂不使用数据库（符合教学阶段要求），
>  并配合安卓端（用户/社交、地图功能）进行接口联调。

------

# 0.4 后端 - 开发流程文档

## 🧩 一、总体说明

### 开发环境

| 项目项   | 说明                                               |
| -------- | -------------------------------------------------- |
| 开发框架 | Spring Boot 3.x                                    |
| 构建工具 | Maven                                              |
| 运行环境 | JDK 17+                                            |
| 存储方式 | 内存（ConcurrentHashMap），无需数据库              |
| API 风格 | RESTful                                            |
| 依赖管理 | Spring Boot Starter Web、Lombok、Spring Validation |
| 测试工具 | Postman / Apifox / cURL                            |
| 输出格式 | JSON                                               |

------

## 🧭 二、阶段划分概览

| 阶段   | 内容                       | 目标                                |
| ------ | -------------------------- | ----------------------------------- |
| 阶段 0 | 项目初始化与结构规划       | 创建标准化 Spring Boot 后端结构     |
| 阶段 1 | 实体与仓库层（Repository） | 建立内存存储逻辑                    |
| 阶段 2 | 业务逻辑层（Service）      | 实现业务规则与数据流转              |
| 阶段 3 | 控制层（Controller）       | 提供 REST 接口                      |
| 阶段 4 | 数据交互与联调             | 与 Android 客户端 API 对接          |
| 阶段 5 | 测试与部署                 | 使用 Postman 进行接口测试与文档完善 |

------

## ⚙️ 三、阶段 0：项目初始化与结构规划

### 1. 创建工程

在 IntelliJ IDEA 或 Eclipse 中新建：

```
spring-boot-backend/
 ├─ src/
 │   ├─ main/
 │   │   ├─ java/com/example/backend/
 │   │   │   ├─ controller/
 │   │   │   ├─ service/
 │   │   │   ├─ repository/
 │   │   │   └─ model/
 │   │   └─ resources/
 │   │       └─ application.yml
 │   └─ test/
 └─ pom.xml
```

### 2. pom.xml 基本依赖

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-validation</artifactId>
    </dependency>
</dependencies>
```

------

## 🧱 四、阶段 1：实体类与数据访问层（Repository）

### 1. 数据模型设计

参考前期数据模型文档，如：

- `User`（用户）
- `Post`（动态）
- `LocationPoint`（位置点）

示例（User）：

```java
@Data
public class User {
    private String id;        // UUID
    private String username;  // 用户名
    private String password;  // 密码（简单存储）
    private String nickname;  // 显示名
    private double lat;       // 当前纬度
    private double lng;       // 当前经度
}
```

### 2. 内存仓库实现

```java
@Repository
public class UserRepository {
    private final Map<String, User> users = new ConcurrentHashMap<>();

    public List<User> findAll() {
        return new ArrayList<>(users.values());
    }

    public Optional<User> findById(String id) {
        return Optional.ofNullable(users.get(id));
    }

    public void save(User user) {
        users.put(user.getId(), user);
    }

    public void delete(String id) {
        users.remove(id);
    }
}
```

------

## 🧩 五、阶段 2：业务逻辑层（Service）

实现核心业务逻辑，如注册、登录、位置上传、好友查询等。

```java
@Service
public class UserService {
    @Autowired
    private UserRepository repo;

    public User register(User user) {
        user.setId(UUID.randomUUID().toString());
        repo.save(user);
        return user;
    }

    public User login(String username, String password) {
        return repo.findAll().stream()
                .filter(u -> u.getUsername().equals(username) && u.getPassword().equals(password))
                .findFirst()
                .orElseThrow(() -> new RuntimeException("Invalid credentials"));
    }

    public void updateLocation(String id, double lat, double lng) {
        User user = repo.findById(id).orElseThrow();
        user.setLat(lat);
        user.setLng(lng);
        repo.save(user);
    }
}
```

------

## 🌐 六、阶段 3：控制层（Controller）

实现 RESTful API 接口。

```java
@RestController
@RequestMapping("/api/user")
public class UserController {

    @Autowired
    private UserService service;

    @PostMapping("/register")
    public User register(@RequestBody User user) {
        return service.register(user);
    }

    @PostMapping("/login")
    public User login(@RequestBody Map<String, String> body) {
        return service.login(body.get("username"), body.get("password"));
    }

    @PostMapping("/{id}/location")
    public ResponseEntity<?> updateLocation(@PathVariable String id, @RequestBody Map<String, Double> body) {
        service.updateLocation(id, body.get("lat"), body.get("lng"));
        return ResponseEntity.ok("Location updated");
    }

    @GetMapping("/all")
    public List<User> allUsers() {
        return service.getAllUsers();
    }
}
```

------

## 🔄 七、阶段 4：与安卓端的接口联调

| 功能         | 请求类型 | 路径                      | 请求体                           | 响应     |
| ------------ | -------- | ------------------------- | -------------------------------- | -------- |
| 用户注册     | POST     | `/api/user/register`      | `{username, password, nickname}` | 用户对象 |
| 登录         | POST     | `/api/user/login`         | `{username, password}`           | 用户对象 |
| 更新位置     | POST     | `/api/user/{id}/location` | `{lat, lng}`                     | OK       |
| 获取全部用户 | GET      | `/api/user/all`           | -                                | 用户数组 |

> 地图开发人员可使用 `/all` 获取所有用户坐标点，在地图上绘制好友位置。
>  社交模块开发人员可通过 `register/login` 实现账号体系。

------

## 🧪 八、阶段 5：测试与部署

### 1. 使用 Postman / Apifox 测试接口

测试流程：

1. 注册 → 登录 → 更新位置
2. 获取全部用户 → 验证坐标同步

### 2. 本地部署

运行：

```bash
mvn spring-boot:run
```

默认端口：`http://localhost:8080`

### 3. 部署方案（可选）

- 使用 `ngrok` 暴露本地接口供安卓端访问；
- 或部署至云服务器（如阿里云、Vercel、Render）。

------

## 📘 九、后续扩展建议

| 模块     | 升级方向                                     |
| -------- | -------------------------------------------- |
| 数据存储 | 从内存结构迁移至数据库（MySQL / PostgreSQL） |
| 安全性   | 增加 JWT 登录鉴权                            |
| 性能     | 增加缓存层（如 Redis）                       |
| 文档     | 使用 Swagger/OpenAPI 自动生成文档            |

------

## ✅ 结语

后端负责人需保证接口的**稳定性与一致性**，
 为前端（安卓用户模块、地图模块）提供统一数据支持。
 建议提前定义接口文档并建立测试用例，确保各模块协作顺畅。

------

是否希望我接着输出 `0.1 后端负责人接口文档`（即与安卓端对应的详细 API 说明表）？
 那份文档会把所有接口字段、请求示例、响应示例都列清楚，方便团队协作。