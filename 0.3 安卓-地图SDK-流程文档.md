好的 ✅ Theresa，这份是你要的 `0.3 安卓-地图SDK-流程文档.md`，我按照你**已有完整安卓项目经验**、**项目工具环境保持一致（Android Studio + Kotlin + Room + RecyclerView + MVVM 架构）\**的标准来写。
 内容以\**实操为导向**，包括阶段划分、关键技术栈、地图SDK建议（如高德/百度/Google Maps 可替换）和每阶段目标。

------

## 0.3 安卓 - 地图SDK 相关开发流程文档

### 🔧 开发环境

- **开发工具**：Android Studio (推荐 Arctic Fox 以上版本)
- **语言**：Kotlin
- **架构模式**：MVVM（ViewModel + LiveData + Repository）
- **UI组件**：RecyclerView、Fragment、BottomNavigation、ViewPager
- **本地数据存储**：Room
- **依赖管理**：Gradle
- **地图SDK**：高德地图（AMap SDK for Android）或 Google Maps（国际版项目）

------

## 🧩 一、阶段 0：环境与SDK准备

### 1. SDK 选择与注册

选择地图 SDK：

- **国内推荐**：高德地图 AMap SDK
- **国际项目**：Google Maps SDK
- 需注册开发者账号，申请 **API Key（密钥）**

### 2. 环境配置

在 `AndroidManifest.xml` 中声明：

```xml
<meta-data
    android:name="com.amap.api.v2.apikey"
    android:value="你的API_KEY" />
```

并添加定位权限：

```xml
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
```

### 3. Gradle 依赖

```gradle
implementation 'com.amap.api:3dmap:latest.integration'
implementation 'com.amap.api:location:latest.integration'
```

------

## 🚀 二、阶段 1：地图模块初始化

### 目标

实现基本的地图显示与交互操作。

### 关键任务

1. 新建 `MapFragment`，布局包含地图容器：

```xml
<com.amap.api.maps.MapView
    android:id="@+id/mapView"
    android:layout_width="match_parent"
    android:layout_height="match_parent" />
```

1. 在 Fragment 中初始化地图：

```kotlin
class MapFragment : Fragment() {
    private lateinit var mapView: MapView
    private lateinit var aMap: AMap

    override fun onCreateView(...) {
        val view = inflater.inflate(R.layout.fragment_map, container, false)
        mapView = view.findViewById(R.id.mapView)
        mapView.onCreate(savedInstanceState)
        aMap = mapView.map
        return view
    }
}
```

1. 启用定位点与缩放操作：

```kotlin
aMap.uiSettings.isZoomControlsEnabled = true
aMap.isMyLocationEnabled = true
```

------

## 📍 三、阶段 2：定位与用户轨迹

### 目标

实现实时定位、位置更新与用户移动路径绘制。

### 核心实现

1. 使用 **AMapLocationClient** 获取用户当前位置；
2. 注册监听器实时更新位置；
3. 绘制移动轨迹（折线）：

```kotlin
val polylineOptions = PolylineOptions()
    .addAll(locationList)
    .color(Color.BLUE)
aMap.addPolyline(polylineOptions)
```

1. 可添加数据库缓存，使用 Room 存储用户的历史轨迹数据。

------

## 📌 四、阶段 3：标记点与信息窗口

### 目标

用户可以：

- 查看附近用户或地点；
- 点击标记显示详细信息；
- 添加收藏点。

### 实现要点

1. 使用 `aMap.addMarker(MarkerOptions().position(latLng).title("xxx"))`
2. 实现自定义 InfoWindowAdapter 显示用户信息；
3. 对接 Room/后端接口，加载动态点位数据。

------

## 🔄 五、阶段 4：与社交模块联动

### 目标

支持：

- 在地图上显示“好友位置”或“打卡点”；
- 点击后跳转至对应用户详情页。

### 技术要点

1. 从用户模块接口加载好友坐标；
2. 使用 ViewModel 统一管理数据；
3. 点击 Marker → 跳转 `UserDetailActivity`。

------

## 🧠 六、阶段 5：性能与交互优化

### 可选优化

| 功能        | 方法                             |
| ----------- | -------------------------------- |
| 地图懒加载  | MapFragment 按需加载             |
| Marker 聚合 | 使用 SDK 提供的 cluster 管理     |
| 缓存策略    | Room + ViewModel + LiveData 联动 |
| 主题适配    | 白天/夜间地图样式切换            |

------

## 🧭 七、阶段 6：测试与集成

### 测试重点

- 定位精度与权限请求；
- 地图缩放、拖动、旋转流畅度；
- 内存泄漏与生命周期同步（mapView.onResume/onPause/onDestroy）；
- 与社交模块的跳转一致性。

------

## ✅ 结语

地图模块开发建议先**单独构建独立模块**（可通过 `feature-map` 子模块形式），
 完成后再与主工程整合，以降低冲突与耦合。

------

