# Android 社交与用户功能说明文档

> 



---

## 🧩 项目结构

```
com.ispot.android
├── ui                   # 界面层
│   ├── login             # 登录
│   ├── register          # 注册
│   ├── feed              # 动态列表与发布
│   └── user              # 用户信息页
├── data                 # 数据与网络层
│   ├── model             # 实体类 (User, Post)
│   ├── network           # Retrofit 接口定义与假数据服务
│   └── repository        # Repository 数据仓库层
└── utils                # 工具类 (Session 管理等)
```

---

## 🧠 核心数据模型

### 🧍 用户模型（User）

| 字段             | 类型     | 说明     |
| -------------- | ------ | ------ |
| id             | String | 用户唯一ID |
| username       | String | 登录用户名  |
| password       | String | 登录密码   |
| nickname       | String | 昵称     |
| avatarUrl      | String | 用户头像   |
| bio            | String | 简介     |
| lastActiveTime | Long   | 最近活跃时间 |

---

### 🗣 动态模型（Post）

| 字段        | 类型     | 说明       |
| --------- | ------ | -------- |
| id        | String | 动态唯一标识   |
| userId    | String | 发布者ID    |
| content   | String | 动态内容     |
| imageUrl  | String | 图片地址（选填） |
| timestamp | Long   | 发布时间     |
| likeCount | Int    | 点赞数      |

---

## 🌐 网络层设计

### `ApiService.kt`

```kotlin
interface ApiService {
    @POST("user/login")
    fun login(@Body request: LoginRequest): Call<LoginResponse>

    @POST("user/register")
    fun register(@Body request: RegisterRequest): Call<RegisterResponse>

    @GET("posts")
    fun getAllPosts(): Call<List<Post>>

    @POST("posts/create")
    fun createPost(@Body post: Post): Call<Post>

    @POST("posts/{id}/like")
    fun likePost(@Path("id") id: String): Call<Void>
}
```

### `FakeApiService.kt`

- 模拟后端数据列表 `users` 与 `posts`  
- 提供登录、注册、发布动态、点赞等逻辑  
- 使用 `FakeCall` 模拟 Retrofit 异步响应  

---

## 🔐 用户功能模块

### 登录 / 注册逻辑

1. 验证输入是否为空  
2. 调用后端接口（Retrofit）  
3. 登录成功后保存 token 与 userId  
4. 跳转至主页面（FeedActivity）

```kotlin
NetworkModule.apiService.login(LoginRequest(u, p)).enqueue(object : Callback<LoginResponse> {
    override fun onResponse(call: Call<LoginResponse>, response: Response<LoginResponse>) {
        val body = response.body()
        if (body != null && body.token?.isNotEmpty() == true) {
            session.saveToken(body.token)
            session.saveUserId(body.user?.id ?: "")
            startActivity(Intent(this@LoginActivity, FeedActivity::class.java))
        } else {
            Toast.makeText(this@LoginActivity, "用户名或密码错误", Toast.LENGTH_SHORT).show()
        }
    }
})
```

---

### 🔑 本地持久化：`SessionManager`

| 功能     | 说明                   |
| ------ | -------------------- |
| 保存登录状态 | 保存 token 与 userId    |
| 自动登录   | 启动时检查是否有 token       |
| 退出登录   | 清空 SharedPreferences |

---

## 👤 用户信息页 UserActivity

- 显示用户名、头像、简介  
- 支持昵称和简介编辑  
- 点击“保存”后发送 `PUT /user/update` 请求

UI 示例：

```xml
<LinearLayout ...>
    <ImageView android:id="@+id/ivAvatar" ... />
    <EditText android:id="@+id/etNickname" ... />
    <EditText android:id="@+id/etBio" ... />
    <Button android:id="@+id/btnSave" android:text="保存" />
</LinearLayout>
```

逻辑要点：

```kotlin
btnSave.setOnClickListener {
    val updatedUser = currentUser.copy(
        nickname = etNickname.text.toString(),
        bio = etBio.text.toString()
    )
    userRepository.updateUser(updatedUser)
}
```

---

## 💬 社交功能模块

### 📜 动态列表（FeedFragment）

- 使用 `RecyclerView` 展示所有动态  
- 每项包括：头像、内容、时间、点赞按钮  
- 点赞状态即时更新  

```kotlin
feedAdapter.onLikeClick = { post ->
    NetworkModule.apiService.likePost(post.id).enqueue(...)
}
```

---

### 📝 发布动态（PostActivity）

- 输入文字内容  
- 选填图片上传  
- 调用 `createPost()` 接口  

```kotlin
btnPublish.setOnClickListener {
    val post = Post(userId = session.getUserId(), content = etContent.text.toString())
    postRepository.createPost(post)
}
```

---

## 🔄 页面与交互流程

```
注册 → 登录 → 主界面（FeedActivity）
                     ├── 动态列表（FeedFragment）
                     ├── 发布动态（PostActivity）
                     └── 用户中心（UserActivity）
```

---

## 📂 主要文件列表

| 文件                  | 功能           |
| ------------------- | ------------ |
| `ApiService.kt`     | Retrofit接口定义 |
| `FakeApiService.kt` | 模拟后端服务       |
| `NetworkModule.kt`  | Retrofit初始化  |
| `UserRepository.kt` | 用户数据管理       |
| `PostRepository.kt` | 动态数据管理       |
| `FeedFragment.kt`   | 动态展示         |
| `PostActivity.kt`   | 发布动态         |
| `UserActivity.kt`   | 用户信息管理       |
| `SessionManager.kt` | 登录状态存储       |
